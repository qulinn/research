# -*- coding: utf-8 -*-
"""make_dataset.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1bOcxZIM-rGbq1NtvlUb63H_sXnQMYCxP
"""

# Commented out IPython magic to ensure Python compatibility.
import os
import glob
import matplotlib.pyplot as plt
# %matplotlib inline
import matplotlib as mpl
mpl.style.use('default')
import cv2
import gc
import collections
import numpy as np
from PIL import Image
from pathlib import Path

from makePatches import makePatches

path_img = 'PATH_IMG'
path_seg = 'PATH_SEG'

save_path = 'SAVE_PATH'

dir_img = sorted(glob.glob(path_img+'/*'))
dir_seg = sorted(glob.glob(path_seg+'/*'))

dataset_img = []
for f in dir_img:
    img = np.array(Image.open(f).convert(mode="L"), np.float32) / 255.0
    dataset_img.append(img)

dataset_seg = []
for f in dir_seg:
    seg = np.array(Image.open(f).convert(mode="L"), np.float32) / 255.0
    dataset_seg.append(seg)

print("dataset_img[0]", dataset_img[0].shape)
print("dataset_seg[0]", dataset_seg[0].shape)


dataset = makePatches(dataset_img, dataset_seg)

patch, label = dataset.img2Patches(1000, 1000, 2000, patchsize=31, save_path=save_path)

print(patch[0].shape)


collections.Counter(label)

plt.figure()
for i in range(30):
    plt.subplot(5, 6, i+1)
    plt.axis('off')
    plt.imshow(patch[i], cmap='gray')
plt.show()
